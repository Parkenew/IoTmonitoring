# 서초구 실내공기질 시각화

## 1. 프로젝트 개요


### **1-1. 프로젝트 목표**

본 프로젝트는 서초구 다중이용시설 공조시스템 관리자가 시설 내의 공기질 데이터를 실시간으로 모니터링할 수 있도록 돕고, 향후 IoT 디바이스와 연동한 스마트 실내 환경 시스템을 구축하는 것을 목표로 함.

### **1-2. 프로젝트 기대효과**

- **실시간 실내공기질 모니터링**: 온도, 습도, 미세먼지, 이산화탄소, 소음 등 눈에 보이지 않는 공기질 데이터를 수치화하여 실시간으로 제공.
- **데이터 통계 제공**: 요일별, 시간별 통계 데이터를 제공하여 장비 오류 및 공기질 이상 징후를 시각적으로 알 수 있도록 함.
- **데이터 기반 시설 운영**: 공기질 악화 시 즉시 조치 가능하도록 데이터 기반 의사결정 지원.

### **1-4. 활용 기술 스택**

- Java(JDK21)
- Apache Kafka(3.9.0)
- Filebeat(8.1.1), Logstash(8.13.3), Elasticsearch(8.13.3), Kibana(8.13.3)

## 2. 데이터 처리


### 2-1. 활용 데이터셋

[서울특별시 서초구_다중이용시설 IoT 과거 실내공기질 가공 데이터_20211210](https://www.data.go.kr/data/15095892/fileData.do)

- **설명**
    
    서초구 그린안심존으로 인증된 다중이용시설에 설치되어 있는 IoT 실내공기질 측정 데이터로
    2021년 8월부터 11월까지의 가공 데이터셋 사용
    
    - 서버 부하를 고려해 80개의 로그파일 중 임의의 5개 로그파일만 사용
    - 8월 데이터를 사용하여 현재 온도 보다 높음
- **측정 항목**
    
    미세먼지(ug/m³), 초미세먼지(ug/m³), 이산화탄소(ppm), 휘발성유기화합물(ppb), 온도(℃),
    습도(%), 소음(dB), 통합지수(CICI)
  
### 2-2. 아키텍쳐
<p align="left">
    <img width="580" alt="Image" src="https://github.com/user-attachments/assets/c5ac3989-7464-423d-ae55-f4f64761196c" />
</p>

- **IoT Dev.(Java):** 데이터셋을 실제 측정 장비처럼 구현하기 위해 장비 시리얼 넘버로 구분된 5개의 데이터 파일에서 매분마다 한줄씩 순서대로 읽어서 하나의 CSV파일에 기록.
- **CSV File(Filebeat):** CSV파일에 데이터가 쓰일때마다 Filebeat가 해당 데이터를 수집하여 Kafka로 전송.
- **Apache Kafka:** Filebeat에서 수집한 실시간 데이터들을 토픽으로 구분하여 분산 저장.
- **Lostasth:** 해당 토픽에 대한 데이터를 수집하고 변환.
- **Elasticsearch:** 변환된 데이터를 인덱싱하여 저장.
- **Kibana:** Elasticsearch에 저장된 데이터를 시각화하여 실내공기질 데이터를 실시간 모니터링.

### 2-3. 데이터 수집 및 가공 과정

- **실시간 데이터 수집**
    - 각 장비의 데이터를 분마다 읽어서 하나의 csv파일에 추가하는 Java 코드 작성하여 구현.
    - Filebeat를 사용하여 실시간 모니터링.
- **Pub/Sub 모델을 사용한 효율적인 데이터 수집**
    - Kafka를 사용하여 Filebeat(Publisher)가 Topic에 발행한 데이터를 보관.
    - Logstash(Subscriber)가 해당 토픽 구독.

- **인덱스 라이프사이클 관리 및 인덱스 템플릿 적용**
    - 인덱스 1일 주기 롤오버, 14일 주기 삭제.
    - 인덱스 템플릿에 Data Stream 적용하여 실시간 데이터 수집.
      
- **Logstash filter를 사용하여 데이터 전처리 후 Elasticsearch에 적재**

## 3. 데이터 시각화

---

### 3-1. 대시보드 개요

- **대시보드 주 사용자**: 서초구 공공시설 공조시스템 담당자
- **측정항목:** 미세먼지(ug/m³), 초미세먼지(ug/m³), 이산화탄소(ppm), 휘발성유기화합물(ppb), 온도(℃), 습도(%), 소음(dB), 통합지수(CICI)
- **기준 수치 참고:**
    
    [실내공기질 관리 기준 | 서울시실내환경관리시스템](https://cleanindoor.seoul.go.kr/contents.do?contentsNo=32&menuNo=193)
    
- **실내공기질 척도:**
    - 매우 좋음: #DDEB9D
        
        ![](attachment:dbb4a999-5544-4d74-bf2d-2a32c840ca67:서초구_실내공기질_데이터_시각화_1aec5c08028080019c51cdc256c51988스크린샷_2025-03-19_오후_5.23.35.png)
        
    - 좋음: #A0C878
        
        ![](attachment:3cb74920-2c17-4ba7-85d7-ef9f4e3f2474:서초구_실내공기질_데이터_시각화_1aec5c08028080019c51cdc256c51988스크린샷_2025-03-19_오후_5.23.40.png)
        
    - 경고: #FFCF50
        
        ![](attachment:d10fe260-3ed7-4f33-8923-bae7bc695612:서초구_실내공기질_데이터_시각화_1aec5c08028080019c51cdc256c51988스크린샷_2025-03-19_오후_5.25.26.png)
        
    - 조치 필요: #EB5B00
        
        ![](attachment:fb9d9880-0f91-44be-a2aa-ade2611b9325:서초구_실내공기질_데이터_시각화_1aec5c08028080019c51cdc256c51988스크린샷_2025-03-19_오후_5.23.44.png)
        

### 3-2. 종합 모니터링

![종합모니터링.png](attachment:d91140a0-c58a-490e-beec-40c9f8eede1d:종합모니터링.png)

- **목적:** 사용자가 모니터링할 장비와 업체를 한눈에 파악할 수 있도록 함.
- **설명:**
    - 업체 위치 패널:
        - 해당 좌표에 커서 올리면 종합 정보를 확인할 수 있도록 설정
        
        ![지도.png](attachment:1dbb6661-3855-47b6-a4b5-480a4457e42d:지도.png)
        
    - 최근 측정 시간 패널:
        - 사용자가 실시간 정보인지 확인 할 수 있도록 우측 상단에 배치.
    - 통계 패널:
        - 공기질 척도 패널 : 색상으로 공기질을 판단할 수 있도록 이미지 패널 배치.
        - 통합지수 평균 최하 3개 업체 패널: 통합 지수 평균 데이터가 가장 낮은 3개의 업체의 평균 통합지수 Gauge 패널 배치.
        - 장비 상태 현황 패널: 측정 실패율이 가장 높은 순으로 정렬하여 관리해야하는 장비를 파악 할 수 있도록 함.

### 3-3. 업체별 실시간 모니터링

![스크린샷 2025-03-24 오후 3.40.13.png](attachment:2bc9d055-cfe8-458b-9b7e-3260ccdda7a6:스크린샷_2025-03-24_오후_3.40.13.png)

- **목적:** 사용자가 한눈에 업체의 공기질상태를 확인할 수 있도록 함.
- **설명:**
    - 장비가 설치된 사업장을 선택하여 쉽게 해당 사업장을 모니터링 할 수 있도록 컨트롤 패널 적용.
    - 실내 대기질 현황 패널
        - 현재기준 공기질 상태를 직관적으로 확인 할 수 있도록 측정항목에 대한 최근 측정값(Last Value)과 수치에 대한 색상을 표기.
    - 장비 상태 현황 패널
        - 장비 상태를 체크할 수 있도록 해당 IoT장비의 측정 실패율(누적오류횟수/누적측정시간*100),측정 성공률(100-측정 실패율)을 표기.
        - 측정 실패율이 3% 이상일시 색상으로 표기.

### 3-4. 업체별 상세 항목

- **목적:** 일별,시간별 통계 데이터를 제공하여 이상수치를 발견 할 수 있도록 함.
- **설명:**
    - 사용자가 이해 하기 쉽도록 공통 템플릿 적용.
    - 기준선(빨간색 선): 서울시 실내공기질 관리 기준치
    - 위치별 패널 설명
        - 상단: 제목 패널, 현재 수치
        - 좌측: 시간별 수치 그래프
        - 중간: 일별 평균 수치 그래프
        - 우측: 일별 최고/최저 수치 표
- **실내 온도 대시보드**
    
    ![스크린샷 2025-03-24 오후 3.40.27.png](attachment:f4714986-27bc-493b-ace4-638af23479ec:스크린샷_2025-03-24_오후_3.40.27.png)
    
- **실내 미세먼지**
    
    ![스크린샷 2025-03-24 오후 3.40.35.png](attachment:75a30e72-a268-4176-a406-7bdff3ecb303:스크린샷_2025-03-24_오후_3.40.35.png)
    
- **실내 초미세먼지**
    
    ![스크린샷 2025-03-24 오후 3.41.00.png](attachment:5e220534-4807-4223-933c-e65edd903ac4:스크린샷_2025-03-24_오후_3.41.00.png)
    
- **실내 습도**
    
    ![스크린샷 2025-03-24 오후 3.41.06.png](attachment:d245154d-a772-4850-9b36-3a9647d434e2:스크린샷_2025-03-24_오후_3.41.06.png)
    
- **실내 소음**
    
    ![스크린샷 2025-03-24 오후 3.41.14.png](attachment:23ae8ba3-ebfa-4143-a70d-314f709a4138:스크린샷_2025-03-24_오후_3.41.14.png)
    
- **실내 휘발성 유기화합물**
    
    ![스크린샷 2025-03-24 오후 3.41.17.png](attachment:b8433a97-7b1d-467a-9908-436c8551e7f9:스크린샷_2025-03-24_오후_3.41.17.png)
    
- **실내 이산화탄소**
    
    ![스크린샷 2025-03-24 오후 3.41.29.png](attachment:51dff260-a209-4143-91d3-c38e395edf23:스크린샷_2025-03-24_오후_3.41.29.png)
    

### 3-5. 시연영상
[![유튜브링크](https://github.com/user-attachments/assets/41ccdd56-27c9-4809-852b-6a57e8016805)](https://youtu.be/ZddAJUwtkIQ?si=DwHQcyWAxX8WO4z7)


## 4. 보완점

### 4-1. 배운점

- **유연한 데이터 처리를 위한 Kafka 활용법**
    
    많은 서비스에서 확장성이 뛰어난 Kafka를 활용하여 데이터를 처리함. Filebeat만을 사용하여 데이터를 수집하는 대신, Pub/Sub 방식을 도입해 동시 다발적으로 발생하는 데이터를 메시지 큐에 저장하고 구독하는 실제 서비스 환경에 가까운 아키텍처를 구성함.
    
- **Elasticsearch ILM 및 Data Stream 활용법**
    
    동일한 인덱스로 데이터를 수집하고 조회를 동시에 진행할 경우 서버에 높은 부하가 발생할 수 있음. 이를 방지하기 위해 하루 주기의 롤오버(Rollover)를 적용한 Data Stream 형태로 메트릭 데이터를 수집해 성능을 최적화함.
    

### 4-2. 보완점

- **인덱스명 동적 할당**
    
    Ruby 코드를 활용하여 인덱스명을 동적으로 할당하면 인덱스 관리가 더욱 용이할 것으로 보임.
    
- **시각화 기획**
    
    기획 단계에서 데이터 표현 방식에 대한 고민이 부족했던 부분이 아쉬움. 시각화를 진행하면서 즉흥적으로 아이디어를 반영하다 보니, 대시보드를 처음부터 다시 구성해야 하는 경우가 발생함. 차후에는 기획 단계에서 시각화의 기본 아웃라인을 수립하는 것이 필요함.
    
- **Kafka 장애 대응 방안**
    
    본 프로젝트에서는 Kafka 기술 도입에 중점을 두었기 때문에 단일 서버만을 운영했으며, 이에 따라 단일 장애 지점(Single Point of Failure, SPOF)의 위험성이 존재함. 이후에는 3개 이상의 Kafka 서버를 운영해 데이터를 분산 저장하고, 고가용성을 유지하는 방안을 고려해야 함.
    
- **Alert 기능 구현**
    
    추후에 Alert 기능을 추가하여  IoT 장비와 연동할 수 있다면 실내 공조 시스템 자동화를 제공하는 솔루션으로 확장 가능함.
